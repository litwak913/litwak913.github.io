<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>将 Spine Runtime 3.8 移植到 Godot | 913 的试验场</title><meta name=keywords content="C++,Godot"><meta name=description content="简单记录了将 Spine Runtime 3.8 移植到 Godot 的过程。"><meta name=author content><link rel=canonical href=https://litwak913.github.io/post/godot-spine38/><link crossorigin=anonymous href=/assets/css/stylesheet.37f30da5de3a3b12b322465a825b444c7e7b30fdbef7fe4e258a4a43bea17946.css integrity="sha256-N/MNpd46OxKzIkZagltETH57MP2+9/5OJYpKQ76heUY=" rel="preload stylesheet" as=style><link rel=icon href=https://litwak913.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://litwak913.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://litwak913.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://litwak913.github.io/apple-touch-icon.png><link rel=mask-icon href=https://litwak913.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://litwak913.github.io/post/godot-spine38/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://litwak913.github.io/post/godot-spine38/"><meta property="og:site_name" content="913 的试验场"><meta property="og:title" content="将 Spine Runtime 3.8 移植到 Godot"><meta property="og:description" content="简单记录了将 Spine Runtime 3.8 移植到 Godot 的过程。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-10-12T22:15:17+08:00"><meta property="article:modified_time" content="2025-10-18T23:15:17+08:00"><meta property="article:tag" content="C++"><meta property="article:tag" content="Godot"><meta name=twitter:card content="summary"><meta name=twitter:title content="将 Spine Runtime 3.8 移植到 Godot"><meta name=twitter:description content="简单记录了将 Spine Runtime 3.8 移植到 Godot 的过程。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://litwak913.github.io/post/"},{"@type":"ListItem","position":2,"name":"将 Spine Runtime 3.8 移植到 Godot","item":"https://litwak913.github.io/post/godot-spine38/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"将 Spine Runtime 3.8 移植到 Godot","name":"将 Spine Runtime 3.8 移植到 Godot","description":"简单记录了将 Spine Runtime 3.8 移植到 Godot 的过程。","keywords":["C++","Godot"],"articleBody":"前言 之前假期无聊没事干，看着一堆从舟里面解包的 Spine 模型，就想着将 Spine Runtime 3.8 移植到 Godot 上。\n先上成品：\n移植基于官方的 spine-godot 运行时集成进行。\n注释\n所有操作均在 Arch Linux 下进行，使用 Godot 4.5。\nWindows 和 macOS 请根据实际情况调整相关命令。\n准备 提前安装好 SCons 和 GCC/Clang/MSVC 等工具链。\n克隆 Spine Runtime 3.8 和 4.2 的仓库，可以使用稀疏检出加快克隆速度。\n1 2 3 4 5 6 7 8 9 git clone git@github.com:EsotericSoftware/spine-runtimes.git --depth=1 --filter=tree:0 -n --branch=3.8 sp38 cd sp38 git sparse-checkout set --no-cone spine-cpp git checkout cd ~ git clone git@github.com:EsotericSoftware/spine-runtimes.git --depth=1 --filter=tree:0 -n --branch=4.2 sp42 cd sp42 git sparse-checkout set --no-cone spine-godot spine-cpp git checkout 克隆 godot-cpp，用于后续 GDExtension 的编译，我这里使用 4.5：\n1 2 cd sp42/spine-godot git clone --depth=1 git@github.com:godotengine/godot-cpp.git -b 4.5 复制 Spine Runtime 3.8 的 spine-cpp 目录：\n1 cp -r sp38/spine-cpp sp42/spine_godot/spind_godot/spine-cpp 注释\n此时可以运行 SCons 生成 compile_commands.json，方便后续导入项目到 IDE：\n1 scons -j8 target=editor compiledb=true use_llvm=true dev_build=true 移植过程 移除新版 Spine Runtime 相关 API 和绑定 主要是移除 Spine 4.2 增加的物理模块（SpinePhysicsConstraintData 和 SpinePhysicsConstraint），以及 Spine 4.0 的时间轴扩展（各种 mix 方法）等部分。\n这一部分可以借助 IDE 进行处理。\nBreaking changes 处理 修改 SpineBoneNode.cpp 中的 update_world_transform 方法：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @@ -190,7 +190,7 @@ if (!sprite) return; if (bone_mode == SpineConstant::BoneMode_Drive) return; sprite-\u003eget_skeleton()-\u003eset_to_setup_pose(); -\tsprite-\u003eget_skeleton()-\u003eupdate_world_transform(SpineConstant::Physics_Update); +\tsprite-\u003eget_skeleton()-\u003eupdate_world_transform(); Transform2D global_transform = sprite-\u003eget_global_bone_transform(bone_name); set_global_transform(global_transform); update_transform(sprite); @@ -274,7 +274,7 @@ auto sprite = find_parent_sprite(); if (!sprite) return; sprite-\u003eget_skeleton()-\u003eset_to_setup_pose(); -\tsprite-\u003eget_skeleton()-\u003eupdate_world_transform(SpineConstant::Physics_Update); +\tsprite-\u003eget_skeleton()-\u003eupdate_world_transform(); } } 修改 SpineSkeleton.cpp 中的 get_bounds：\n1 2 3 4 5 6 7 8 Rect2 SpineSkeleton::get_bounds() { SPINE_CHECK(skeleton, Rect2(0, 0, 0, 0)) float x, y, w, h; -\tspine::SkeletonClipping clipper; -\tskeleton-\u003egetBounds(x, y, w, h, bounds_vertex_buffer, \u0026clipper); +\tskeleton-\u003egetBounds(x, y, w, h, bounds_vertex_buffer); return Rect2(x, y, w, h); } 并调整方法签名：\n1 2 3 4 5 6 7 8 9 @@ -33,7 +33,7 @@ #include void SpineSkeleton::_bind_methods() { -\tClassDB::bind_method(D_METHOD(\"update_world_transform\", \"physics\"), \u0026SpineSkeleton::update_world_transform); +\tClassDB::bind_method(D_METHOD(\"update_world_transform\"), \u0026SpineSkeleton::update_world_transform); ClassDB::bind_method(D_METHOD(\"set_to_setup_pose\"), \u0026SpineSkeleton::set_to_setup_pose); ClassDB::bind_method(D_METHOD(\"set_bones_to_setup_pose\"), \u0026SpineSkeleton::set_bones_to_setup_pose); ClassDB::bind_method(D_METHOD(\"set_slots_to_setup_pose\"), \u0026SpineSkeleton::set_slots_to_setup_pose); 加入部分 API 并更新头文件 修改 AnimationStateData.h 和 AnimationStateData.cpp\n1 2 3 4 5 // AnimationStateData.cpp void AnimationStateData::clear() { _defaultMix = 0; _animationToMixTime.clear(); } 1 2 3 4 // AnimationStateData.h public: // ... void clear(); 并使用 Spine Runtime 4.2 的 SpineString.h（位于 include/spine/SpineString.h） 替换 3.8 的 SpineString.h。\n更改 Skel 加载部分 更改 SpineSkeletonFileResource.cpp：\n主要修改检查的 Skel 版本字符串为 3.8，同时需要先读取一次 Skel 的 hash，才能正常读取版本，记得释放读取的 hash：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 @@ -99,7 +98,7 @@ static bool checkVersion(const char *version) { if (!version) return false; -\tchar *result = (char *) (strstr(version, SPINE_VERSION_STRING) - version); +\tchar *result = (char *) (strstr(version, \"3.8\") - version); return result == 0; } @@ -118,7 +117,9 @@ input.cursor = (const unsigned char *) binaryData; input.end = (const unsigned char *) binaryData + length; // Skip hash -\tinput.cursor += 8; +\t// input.cursor += 8; +\tchar *hash = readString(\u0026input); +\tspine::SpineExtension::free(hash, __FILE__, __LINE__); char *version = readString(\u0026input); bool result = checkVersion(version); spine::SpineExtension::free(version, __FILE__, __LINE__); 更改 Atlas 加载部分 在 SpineAtlasResource.cpp 中查找并进行以下修改：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 @@ -159,7 +159,7 @@ renderer_object-\u003etexture = Ref(nullptr); renderer_object-\u003enormal_map = Ref(nullptr); renderer_object-\u003especular_map = Ref(nullptr); -\tpage.texture = (void *) renderer_object; +\tpage.setRendererObject((void *) renderer_object); return; } @@ -209,8 +209,7 @@ renderer_object-\u003ecanvas_texture-\u003eset_normal_texture(renderer_object-\u003enormal_map); renderer_object-\u003ecanvas_texture-\u003eset_specular_texture(renderer_object-\u003especular_map); #endif - -\tpage.texture = (void *) renderer_object; +\tpage.setRendererObject((void *) renderer_object); page.width = texture-\u003eget_width(); page.height = texture-\u003eget_height(); } @@ -335,7 +334,7 @@ clear(); texture_loader = new GodotSpineTextureLoader(\u0026textures, \u0026normal_maps, \u0026specular_maps, normal_map_prefix, specular_map_prefix, false); auto utf8 = atlas_data.utf8(); -\tatlas = new spine::Atlas(utf8.ptr(), utf8.size(), source_path.get_base_dir().utf8(), texture_loader); +\tatlas = new spine::Atlas(utf8.ptr(), utf8.size() - 1, source_path.get_base_dir().utf8(), texture_loader); if (atlas) return OK; clear(); 不知道为什么，这里需要将 size 减去 1 才能让 Runtime 正常读取 atlas。\n更改 Bone 和 RendererObject 渲染部分 在 SpineSprite.cpp 中进行以下修改：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 @@ -869,8 +870,8 @@ auto *region = (spine::RegionAttachment *) attachment; vertices-\u003esetSize(8, 0); -\tregion-\u003ecomputeWorldVertices(*slot, *vertices, 0); -\trenderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) region-\u003egetRegion())-\u003epage-\u003etexture; +\tregion-\u003ecomputeWorldVertices(slot-\u003egetBone(), *vertices, 0); +\trenderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) region-\u003egetRendererObject())-\u003epage-\u003egetRendererObject(); uvs = \u0026region-\u003egetUVs(); indices = \u0026statics.quad_indices; @@ -884,7 +885,7 @@ vertices-\u003esetSize(mesh-\u003egetWorldVerticesLength(), 0); mesh-\u003ecomputeWorldVertices(*slot, *vertices); -\trenderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) mesh-\u003egetRegion())-\u003epage-\u003etexture; +\trenderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) mesh-\u003egetRendererObject())-\u003epage-\u003egetRendererObject(); uvs = \u0026mesh-\u003egetUVs(); indices = \u0026mesh-\u003egetTriangles(); @@ -1052,7 +1053,7 @@ auto *region = (spine::RegionAttachment *) attachment; auto *vertices = \u0026statics.scratch_vertices; vertices-\u003esetSize(8, 0); -\tregion-\u003ecomputeWorldVertices(*slot, *vertices, 0); +\tregion-\u003ecomputeWorldVertices(slot-\u003egetBone(), *vertices, 0); // Render triangles. createLinesFromMesh(statics.scratch_points, statics.quad_indices, vertices); 编译和安装 全部准备好后就可以开始编译了。\n1 scons -j8 target=editor compiledb=true use_llvm=true dev_build=true 最终编译的 so 位于 bin/linux/libspine_godot.linux.editor.dev.x86_64.so。\n将 bin/linux/libspine_godot.linux.editor.dev.x86_64.so 复制到项目的 bin/linux/libspine_godot.linux.editor.x86_64.so。\n将 spine_godot_extension.gdextension 复制到项目的 bin/。\n完成后启动 Godot 编辑器即可。\n成品 所有的 Patch 已经放在下面的仓库：litwak913/spine38-godot-patches\n目前的 Patch 基于 EsotericSoftware/spine-runtimes 仓库中 commit 3653540558ba09104065addc56178dc2bceafc24 修改。\n警告\n此 Patch 仍处于实验状态，请勿用于生产环境。\n","wordCount":"1466","inLanguage":"zh","datePublished":"2025-10-12T22:15:17+08:00","dateModified":"2025-10-18T23:15:17+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://litwak913.github.io/post/godot-spine38/"},"publisher":{"@type":"Organization","name":"913 的试验场","logo":{"@type":"ImageObject","url":"https://litwak913.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://litwak913.github.io/ accesskey=h title="913 的试验场 (Alt + H)">913 的试验场</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://litwak913.github.io/ title="913 的试验场"><span>首页</span></a></li><li><a href=https://litwak913.github.io/tags/ title=Tags><span>标签</span></a></li><li><a href=https://litwak913.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://litwak913.github.io/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://litwak913.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://litwak913.github.io/post/>Posts</a></div><h1 class="post-title entry-hint-parent">将 Spine Runtime 3.8 移植到 Godot</h1><div class=post-meta><span title='2025-10-12 22:15:17 +0800 CST'>2025-10-12</span>&nbsp;·&nbsp;<span title='2025-10-18 23:15:17 +0800 CST'>更新于 2025-10-18</span></div></header><div class=post-content><h1 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h1><p>之前假期无聊没事干，看着一堆从舟里面解包的 Spine 模型，就想着将 Spine Runtime 3.8 移植到 Godot 上。</p><p>先上成品：</p><p><img alt=成品 loading=lazy src=/post/godot-spine38/final.webp></p><p>移植基于官方的 <a href=https://github.com/EsotericSoftware/spine-runtimes/tree/4.2/spine-godot>spine-godot</a> 运行时集成进行。</p><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}@media(prefers-color-scheme:dark){.notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}.notice.info{--title-background-color:#a50;--content-background-color:#420}.notice.tip{--title-background-color:#363;--content-background-color:#121}.notice.warning{--title-background-color:#800;--content-background-color:#400}}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice note"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="0 128 300 300"><path d="M150 128c82.813.0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812.0 278c0-82.813 67.188-150 150-150zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515.0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32.0 6.055-2.93 6.055-6.445zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758.0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515.0 6.445-2.148 6.64-4.883z"/></svg>
</span>注释</p><p>所有操作均在 Arch Linux 下进行，使用 Godot 4.5。</p><p>Windows 和 macOS 请根据实际情况调整相关命令。</p></div><h1 id=准备>准备<a hidden class=anchor aria-hidden=true href=#准备>#</a></h1><p>提前安装好 SCons 和 GCC/Clang/MSVC 等工具链。</p><p>克隆 Spine Runtime 3.8 和 4.2 的仓库，可以使用稀疏检出加快克隆速度。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone git@github.com:EsotericSoftware/spine-runtimes.git --depth<span class=o>=</span><span class=m>1</span> --filter<span class=o>=</span>tree:0 -n --branch<span class=o>=</span>3.8 sp38
</span></span><span class=line><span class=cl><span class=nb>cd</span> sp38
</span></span><span class=line><span class=cl>git sparse-checkout <span class=nb>set</span> --no-cone spine-cpp
</span></span><span class=line><span class=cl>git checkout
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~
</span></span><span class=line><span class=cl>git clone git@github.com:EsotericSoftware/spine-runtimes.git --depth<span class=o>=</span><span class=m>1</span> --filter<span class=o>=</span>tree:0 -n --branch<span class=o>=</span>4.2 sp42
</span></span><span class=line><span class=cl><span class=nb>cd</span> sp42
</span></span><span class=line><span class=cl>git sparse-checkout <span class=nb>set</span> --no-cone spine-godot spine-cpp
</span></span><span class=line><span class=cl>git checkout
</span></span></code></pre></td></tr></table></div></div><p>克隆 <code>godot-cpp</code>，用于后续 GDExtension 的编译，我这里使用 4.5：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> sp42/spine-godot
</span></span><span class=line><span class=cl>git clone --depth<span class=o>=</span><span class=m>1</span> git@github.com:godotengine/godot-cpp.git -b 4.5
</span></span></code></pre></td></tr></table></div></div><p>复制 Spine Runtime 3.8 的 <code>spine-cpp</code> 目录：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp -r sp38/spine-cpp sp42/spine_godot/spind_godot/spine-cpp
</span></span></code></pre></td></tr></table></div></div><div class="notice note"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="0 128 300 300"><path d="M150 128c82.813.0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812.0 278c0-82.813 67.188-150 150-150zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515.0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32.0 6.055-2.93 6.055-6.445zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758.0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515.0 6.445-2.148 6.64-4.883z"/></svg>
</span>注释</p><p>此时可以运行 SCons 生成 <code>compile_commands.json</code>，方便后续导入项目到 IDE：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scons -j8 <span class=nv>target</span><span class=o>=</span>editor <span class=nv>compiledb</span><span class=o>=</span><span class=nb>true</span> <span class=nv>use_llvm</span><span class=o>=</span><span class=nb>true</span> <span class=nv>dev_build</span><span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div></div><h1 id=移植过程>移植过程<a hidden class=anchor aria-hidden=true href=#移植过程>#</a></h1><h2 id=移除新版-spine-runtime-相关-api-和绑定>移除新版 Spine Runtime 相关 API 和绑定<a hidden class=anchor aria-hidden=true href=#移除新版-spine-runtime-相关-api-和绑定>#</a></h2><p>主要是移除 Spine 4.2 增加的物理模块（<code>SpinePhysicsConstraintData</code> 和 <code>SpinePhysicsConstraint</code>），以及 Spine 4.0 的时间轴扩展（各种 mix 方法）等部分。</p><p>这一部分可以借助 IDE 进行处理。</p><p><img alt=移除绑定 loading=lazy src=/post/godot-spine38/remove.webp></p><h2 id=breaking-changes-处理>Breaking changes 处理<a hidden class=anchor aria-hidden=true href=#breaking-changes-处理>#</a></h2><p>修改 <code>SpineBoneNode.cpp</code> 中的 <code>update_world_transform</code> 方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@@ -190,7 +190,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 	if (!sprite) return;
</span></span><span class=line><span class=cl> 	if (bone_mode == SpineConstant::BoneMode_Drive) return;
</span></span><span class=line><span class=cl> 	sprite-&gt;get_skeleton()-&gt;set_to_setup_pose();
</span></span><span class=line><span class=cl><span class=gd>-	sprite-&gt;get_skeleton()-&gt;update_world_transform(SpineConstant::Physics_Update);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+	sprite-&gt;get_skeleton()-&gt;update_world_transform();
</span></span></span><span class=line><span class=cl><span class=gi></span> 	Transform2D global_transform = sprite-&gt;get_global_bone_transform(bone_name);
</span></span><span class=line><span class=cl> 	set_global_transform(global_transform);
</span></span><span class=line><span class=cl> 	update_transform(sprite);
</span></span><span class=line><span class=cl><span class=gu>@@ -274,7 +274,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 		auto sprite = find_parent_sprite();
</span></span><span class=line><span class=cl> 		if (!sprite) return;
</span></span><span class=line><span class=cl> 		sprite-&gt;get_skeleton()-&gt;set_to_setup_pose();
</span></span><span class=line><span class=cl><span class=gd>-		sprite-&gt;get_skeleton()-&gt;update_world_transform(SpineConstant::Physics_Update);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+		sprite-&gt;get_skeleton()-&gt;update_world_transform();
</span></span></span><span class=line><span class=cl><span class=gi></span> 	}
</span></span><span class=line><span class=cl> }
</span></span></code></pre></td></tr></table></div></div><p>修改 <code>SpineSkeleton.cpp</code> 中的 <code>get_bounds</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl> Rect2 SpineSkeleton::get_bounds() {
</span></span><span class=line><span class=cl> 	SPINE_CHECK(skeleton, Rect2(0, 0, 0, 0))
</span></span><span class=line><span class=cl> 	float x, y, w, h;
</span></span><span class=line><span class=cl><span class=gd>-	spine::SkeletonClipping clipper;
</span></span></span><span class=line><span class=cl><span class=gd>-	skeleton-&gt;getBounds(x, y, w, h, bounds_vertex_buffer, &amp;clipper);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+	skeleton-&gt;getBounds(x, y, w, h, bounds_vertex_buffer);
</span></span></span><span class=line><span class=cl><span class=gi></span> 	return Rect2(x, y, w, h);
</span></span><span class=line><span class=cl> }
</span></span></code></pre></td></tr></table></div></div><p>并调整方法签名：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@@ -33,7 +33,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> #include &lt;spine/SkeletonClipping.h&gt;
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> void SpineSkeleton::_bind_methods() {
</span></span><span class=line><span class=cl><span class=gd>-	ClassDB::bind_method(D_METHOD(&#34;update_world_transform&#34;, &#34;physics&#34;), &amp;SpineSkeleton::update_world_transform);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+	ClassDB::bind_method(D_METHOD(&#34;update_world_transform&#34;), &amp;SpineSkeleton::update_world_transform);
</span></span></span><span class=line><span class=cl><span class=gi></span> 	ClassDB::bind_method(D_METHOD(&#34;set_to_setup_pose&#34;), &amp;SpineSkeleton::set_to_setup_pose);
</span></span><span class=line><span class=cl> 	ClassDB::bind_method(D_METHOD(&#34;set_bones_to_setup_pose&#34;), &amp;SpineSkeleton::set_bones_to_setup_pose);
</span></span><span class=line><span class=cl> 	ClassDB::bind_method(D_METHOD(&#34;set_slots_to_setup_pose&#34;), &amp;SpineSkeleton::set_slots_to_setup_pose);
</span></span></code></pre></td></tr></table></div></div><h2 id=加入部分-api-并更新头文件>加入部分 API 并更新头文件<a hidden class=anchor aria-hidden=true href=#加入部分-api-并更新头文件>#</a></h2><p>修改 <code>AnimationStateData.h</code> 和 <code>AnimationStateData.cpp</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// AnimationStateData.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=n>AnimationStateData</span><span class=o>::</span><span class=n>clear</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>_defaultMix</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>_animationToMixTime</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// AnimationStateData.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=n>clear</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>并使用 Spine Runtime 4.2 的 <code>SpineString.h</code>（位于 <code>include/spine/SpineString.h</code>） 替换 3.8 的 <code>SpineString.h</code>。</p><h2 id=更改-skel-加载部分>更改 Skel 加载部分<a hidden class=anchor aria-hidden=true href=#更改-skel-加载部分>#</a></h2><p>更改 <code>SpineSkeletonFileResource.cpp</code>：</p><p>主要修改检查的 Skel 版本字符串为 3.8，同时需要先读取一次 Skel 的 hash，才能正常读取版本，记得释放读取的 hash：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@@ -99,7 +98,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 
</span></span><span class=line><span class=cl> static bool checkVersion(const char *version) {
</span></span><span class=line><span class=cl> 	if (!version) return false;
</span></span><span class=line><span class=cl><span class=gd>-	char *result = (char *) (strstr(version, SPINE_VERSION_STRING) - version);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+	char *result = (char *) (strstr(version, &#34;3.8&#34;) - version);
</span></span></span><span class=line><span class=cl><span class=gi></span> 	return result == 0;
</span></span><span class=line><span class=cl> }
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=gu>@@ -118,7 +117,9 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 	input.cursor = (const unsigned char *) binaryData;
</span></span><span class=line><span class=cl> 	input.end = (const unsigned char *) binaryData + length;
</span></span><span class=line><span class=cl> 	// Skip hash
</span></span><span class=line><span class=cl><span class=gd>-	input.cursor += 8;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+	// input.cursor += 8;
</span></span></span><span class=line><span class=cl><span class=gi>+	char *hash = readString(&amp;input);
</span></span></span><span class=line><span class=cl><span class=gi>+	spine::SpineExtension::free(hash, __FILE__, __LINE__);
</span></span></span><span class=line><span class=cl><span class=gi></span> 	char *version = readString(&amp;input);
</span></span><span class=line><span class=cl> 	bool result = checkVersion(version);
</span></span><span class=line><span class=cl> 	spine::SpineExtension::free(version, __FILE__, __LINE__);
</span></span></code></pre></td></tr></table></div></div><h2 id=更改-atlas-加载部分>更改 Atlas 加载部分<a hidden class=anchor aria-hidden=true href=#更改-atlas-加载部分>#</a></h2><p>在 <code>SpineAtlasResource.cpp</code> 中查找并进行以下修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@@ -159,7 +159,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 			renderer_object-&gt;texture = Ref&lt;Texture&gt;(nullptr);
</span></span><span class=line><span class=cl> 			renderer_object-&gt;normal_map = Ref&lt;Texture&gt;(nullptr);
</span></span><span class=line><span class=cl> 			renderer_object-&gt;specular_map = Ref&lt;Texture&gt;(nullptr);
</span></span><span class=line><span class=cl><span class=gd>-			page.texture = (void *) renderer_object;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+			page.setRendererObject((void *) renderer_object);
</span></span></span><span class=line><span class=cl><span class=gi></span> 			return;
</span></span><span class=line><span class=cl> 		}
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=gu>@@ -209,8 +209,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 		renderer_object-&gt;canvas_texture-&gt;set_normal_texture(renderer_object-&gt;normal_map);
</span></span><span class=line><span class=cl> 		renderer_object-&gt;canvas_texture-&gt;set_specular_texture(renderer_object-&gt;specular_map);
</span></span><span class=line><span class=cl> #endif
</span></span><span class=line><span class=cl><span class=gd>-
</span></span></span><span class=line><span class=cl><span class=gd>-		page.texture = (void *) renderer_object;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+		page.setRendererObject((void *) renderer_object);
</span></span></span><span class=line><span class=cl><span class=gi></span> 		page.width = texture-&gt;get_width();
</span></span><span class=line><span class=cl> 		page.height = texture-&gt;get_height();
</span></span><span class=line><span class=cl> 	}
</span></span><span class=line><span class=cl><span class=gu>@@ -335,7 +334,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 	clear();
</span></span><span class=line><span class=cl> 	texture_loader = new GodotSpineTextureLoader(&amp;textures, &amp;normal_maps, &amp;specular_maps, normal_map_prefix, specular_map_prefix, false);
</span></span><span class=line><span class=cl> 	auto utf8 = atlas_data.utf8();
</span></span><span class=line><span class=cl><span class=gd>-	atlas = new spine::Atlas(utf8.ptr(), utf8.size(), source_path.get_base_dir().utf8(), texture_loader);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+	atlas = new spine::Atlas(utf8.ptr(), utf8.size() - 1, source_path.get_base_dir().utf8(), texture_loader);
</span></span></span><span class=line><span class=cl><span class=gi></span> 	if (atlas) return OK;
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 	clear();
</span></span></code></pre></td></tr></table></div></div><p>不知道为什么，这里需要将 <code>size</code> 减去 1 才能让 Runtime 正常读取 atlas。</p><h2 id=更改-bone-和-rendererobject-渲染部分>更改 Bone 和 RendererObject 渲染部分<a hidden class=anchor aria-hidden=true href=#更改-bone-和-rendererobject-渲染部分>#</a></h2><p>在 <code>SpineSprite.cpp</code> 中进行以下修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gu>@@ -869,8 +870,8 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 			auto *region = (spine::RegionAttachment *) attachment;
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 			vertices-&gt;setSize(8, 0);
</span></span><span class=line><span class=cl><span class=gd>-			region-&gt;computeWorldVertices(*slot, *vertices, 0);
</span></span></span><span class=line><span class=cl><span class=gd>-			renderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) region-&gt;getRegion())-&gt;page-&gt;texture;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+			region-&gt;computeWorldVertices(slot-&gt;getBone(), *vertices, 0);
</span></span></span><span class=line><span class=cl><span class=gi>+			renderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) region-&gt;getRendererObject())-&gt;page-&gt;getRendererObject();
</span></span></span><span class=line><span class=cl><span class=gi></span> 			uvs = &amp;region-&gt;getUVs();
</span></span><span class=line><span class=cl> 			indices = &amp;statics.quad_indices;
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=gu>@@ -884,7 +885,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 
</span></span><span class=line><span class=cl> 			vertices-&gt;setSize(mesh-&gt;getWorldVerticesLength(), 0);
</span></span><span class=line><span class=cl> 			mesh-&gt;computeWorldVertices(*slot, *vertices);
</span></span><span class=line><span class=cl><span class=gd>-			renderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) mesh-&gt;getRegion())-&gt;page-&gt;texture;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+			renderer_object = (SpineRendererObject *) ((spine::AtlasRegion *) mesh-&gt;getRendererObject())-&gt;page-&gt;getRendererObject();
</span></span></span><span class=line><span class=cl><span class=gi></span> 			uvs = &amp;mesh-&gt;getUVs();
</span></span><span class=line><span class=cl> 			indices = &amp;mesh-&gt;getTriangles();
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=gu>@@ -1052,7 +1053,7 @@
</span></span></span><span class=line><span class=cl><span class=gu></span> 			auto *region = (spine::RegionAttachment *) attachment;
</span></span><span class=line><span class=cl> 			auto *vertices = &amp;statics.scratch_vertices;
</span></span><span class=line><span class=cl> 			vertices-&gt;setSize(8, 0);
</span></span><span class=line><span class=cl><span class=gd>-			region-&gt;computeWorldVertices(*slot, *vertices, 0);
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+			region-&gt;computeWorldVertices(slot-&gt;getBone(), *vertices, 0);
</span></span></span><span class=line><span class=cl><span class=gi></span> 
</span></span><span class=line><span class=cl> 			// Render triangles.
</span></span><span class=line><span class=cl> 			createLinesFromMesh(statics.scratch_points, statics.quad_indices, vertices);
</span></span></code></pre></td></tr></table></div></div><h1 id=编译和安装>编译和安装<a hidden class=anchor aria-hidden=true href=#编译和安装>#</a></h1><p>全部准备好后就可以开始编译了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scons -j8 <span class=nv>target</span><span class=o>=</span>editor <span class=nv>compiledb</span><span class=o>=</span><span class=nb>true</span> <span class=nv>use_llvm</span><span class=o>=</span><span class=nb>true</span> <span class=nv>dev_build</span><span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><p>最终编译的 so 位于 <code>bin/linux/libspine_godot.linux.editor.dev.x86_64.so</code>。</p><p>将 <code>bin/linux/libspine_godot.linux.editor.dev.x86_64.so</code> 复制到项目的 <code>bin/linux/libspine_godot.linux.editor.x86_64.so</code>。</p><p>将 <code>spine_godot_extension.gdextension</code> 复制到项目的 <code>bin/</code>。</p><p>完成后启动 Godot 编辑器即可。</p><h1 id=成品>成品<a hidden class=anchor aria-hidden=true href=#成品>#</a></h1><p>所有的 Patch 已经放在下面的仓库：<a href=https://github.com/litwak913/spine38-godot-patches>litwak913/spine38-godot-patches</a></p><p>目前的 Patch 基于 <a href=https://github.com/EsotericSoftware/spine-runtimes>EsotericSoftware/spine-runtimes</a> 仓库中 commit <code>3653540558ba09104065addc56178dc2bceafc24</code> 修改。</p><div class="notice warning"><p class=notice-title><span class="icon-notice baseline"><svg viewBox="126 76.5 300 300"><path d="M297.431 324.397v-34.255c0-3.245-2.344-5.95-5.358-5.95h-32.146c-3.014.0-5.358 2.705-5.358 5.95v34.255c0 3.245 2.344 5.95 5.358 5.95h32.146c3.014.0 5.358-2.705 5.358-5.95zm-.335-67.428 3.014-82.753c0-1.081-.502-2.524-1.674-3.425-1.005-.902-2.512-1.983-4.019-1.983h-36.834c-1.507.0-3.014 1.081-4.019 1.983-1.172.901-1.674 2.704-1.674 3.786l2.846 82.392c0 2.344 2.512 4.146 5.693 4.146h30.975c3.013.0 5.525-1.803 5.692-4.146zm-2.344-168.39L423.34 342.425c3.683 7.032 3.516 15.686-.335 22.717-3.85 7.031-10.883 11.358-18.417 11.358H147.413c-7.534.0-14.566-4.327-18.417-11.358-3.85-7.031-4.018-15.685-.335-22.716L257.248 88.578C260.93 81.188 268.13 76.5 276 76.5s15.069 4.688 18.752 12.08z"/></svg>
</span>警告</p><p>此 Patch 仍处于实验状态，请勿用于生产环境。</p></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://litwak913.github.io/tags/c++/>C++</a></li><li><a href=https://litwak913.github.io/tags/godot/>Godot</a></li></ul></footer><script src=https://utteranc.es/client.js repo=litwak913/litwak913.github.io issue-term=pathname theme=preferred-color-scheme crossorigin=anonymous async></script></article></main><footer class=footer><span><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>